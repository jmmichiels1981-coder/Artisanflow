<!DOCTYPE html>
<html>
<head>
    <title>TEST - RÃ©initialisation complÃ¨te</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        pre { background: #000; padding: 10px; border: 1px solid #00ff00; }
    </style>
</head>
<body>
    <h1>ğŸ”§ TEST RÃ‰INITIALISATION COMPLÃˆTE</h1>
    
    <h2>Ã‰tape 1 : Ã‰tat actuel</h2>
    <button onclick="checkState()">VÃ©rifier l'Ã©tat actuel</button>
    <pre id="current-state"></pre>
    
    <h2>Ã‰tape 2 : RÃ©initialisation TOTALE</h2>
    <button onclick="fullReset()" style="background: red; color: white; font-weight: bold;">
        ğŸ—‘ï¸ RÃ‰INITIALISER TOUT
    </button>
    <pre id="reset-result"></pre>
    
    <h2>Ã‰tape 3 : VÃ©rification aprÃ¨s reset</h2>
    <button onclick="checkAfterReset()">VÃ©rifier aprÃ¨s reset</button>
    <pre id="after-reset"></pre>
    
    <h2>Ã‰tape 4 : Redirection</h2>
    <button onclick="goToApp()" style="background: green; color: white; font-weight: bold;">
        âœ… Aller Ã  l'application
    </button>

    <script>
        function checkState() {
            const state = {
                'af_config_artisan': localStorage.getItem('af_config_artisan'),
                'af_traiter_tutorial_seen': localStorage.getItem('af_traiter_tutorial_seen'),
                'tutorial_devis_envoyes_seen': localStorage.getItem('tutorial_devis_envoyes_seen'),
                'tutorial_devis_relancer_seen': localStorage.getItem('tutorial_devis_relancer_seen'),
                'tutorial_devis_acceptes_seen': localStorage.getItem('tutorial_devis_acceptes_seen'),
                'tutorial_devis_refuses_seen': localStorage.getItem('tutorial_devis_refuses_seen'),
                'tutorial_historique_devis_seen': localStorage.getItem('tutorial_historique_devis_seen'),
                'Total clÃ©s': Object.keys(localStorage).length
            };
            
            document.getElementById('current-state').textContent = JSON.stringify(state, null, 2);
            
            if (!state['af_config_artisan']) {
                console.log('âœ… PAS de config artisan - Modal DEVRAIT s\'afficher');
            } else {
                console.log('âŒ Config artisan existe - Modal NE s\'affichera PAS');
            }
        }
        
        function fullReset() {
            console.log('ğŸ”¥ RÃ‰INITIALISATION COMPLÃˆTE...');
            
            // Lister toutes les clÃ©s AVANT
            const keysBefore = Object.keys(localStorage).length;
            console.log(`ğŸ“Š Avant : ${keysBefore} clÃ©s`);
            
            // SUPPRIMER TOUT
            localStorage.clear();
            
            // VÃ©rifier
            const keysAfter = Object.keys(localStorage).length;
            console.log(`ğŸ“Š AprÃ¨s : ${keysAfter} clÃ©s`);
            
            // Supprimer aussi sessionStorage
            sessionStorage.clear();
            
            const result = {
                success: true,
                message: 'TOUT SUPPRIMÃ‰',
                keysDeleted: keysBefore,
                keysRemaining: keysAfter,
                localStorage_empty: keysAfter === 0,
                sessionStorage_empty: Object.keys(sessionStorage).length === 0
            };
            
            document.getElementById('reset-result').textContent = JSON.stringify(result, null, 2);
            document.getElementById('reset-result').style.color = result.localStorage_empty ? '#00ff00' : '#ff0000';
            
            if (result.localStorage_empty) {
                console.log('âœ… SUCCESS : localStorage complÃ¨tement vide');
            } else {
                console.error('âŒ ERREUR : localStorage pas vide !');
            }
        }
        
        function checkAfterReset() {
            const keys = Object.keys(localStorage);
            const result = {
                isEmpty: keys.length === 0,
                totalKeys: keys.length,
                keys: keys,
                shouldShowConfig: !localStorage.getItem('af_config_artisan'),
                shouldShowTraiterTutorial: !localStorage.getItem('af_traiter_tutorial_seen')
            };
            
            document.getElementById('after-reset').textContent = JSON.stringify(result, null, 2);
            
            if (result.isEmpty) {
                console.log('âœ… localStorage vide - Nouveau utilisateur simulÃ©');
                console.log('âœ… Modal configuration DEVRAIT s\'afficher');
                console.log('âœ… Tous les tutoriels DEVRAIENT s\'afficher');
            } else {
                console.error('âŒ localStorage PAS vide !', keys);
            }
        }
        
        function goToApp() {
            // DerniÃ¨re vÃ©rification
            if (localStorage.length === 0) {
                console.log('âœ… Redirection vers l\'app...');
                window.location.href = '/';
            } else {
                alert('âš ï¸ localStorage pas vide ! Cliquez sur RÃ‰INITIALISER TOUT d\'abord');
            }
        }
        
        // Auto-check au chargement
        window.onload = () => {
            checkState();
            console.log('ğŸ“‹ Page de test chargÃ©e');
            console.log('ğŸ‘‰ Cliquez sur "VÃ©rifier l\'Ã©tat actuel" pour voir les donnÃ©es');
        };
    </script>
</body>
</html>
